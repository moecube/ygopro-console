// Generated by CoffeeScript 2.0.0-beta3
(function() {
  var author, express, path, server, user;

  express = require('express');

  user = require('./user');

  author = require('./author').authorize;

  path = require('path');

  server = express();

  server.use(express.static('react-pages/build'));

  server.use('/user/*', function(req, res, next) {
    var sig, sso;
    sso = req.query.sso;
    sig = req.query.sig;
    if (author(sso, sig)) {
      return next();
    } else {
      res.statusCode = 403;
      return res.end("Not authorized");
    }
  });

  server.get('/user/:target_username', function(req, res) {
    var target_username;
    target_username = req.params.target_username;
    return user.queryUser(target_username, function(result) {
      return res.json(result);
    });
  });

  server.post('/user/:target_username/dp/:value', function(req, res) {
    var dp, target_username;
    target_username = req.params.target_username;
    dp = parseFloat(req.params.value);
    if (dp === (0/0)) {
      res.statusCode = 400;
      res.end("no dp");
      return;
    }
    return user.setUserDp(target_username, dp, function(result) {
      return res.end("ok");
    });
  });

  server.get('*', function(req, res) {
    return res.sendFile(path.resolve('react-pages/build', 'index.html'));
  });

  server.listen(9999);

}).call(this);

//# sourceMappingURL=server.js.map
